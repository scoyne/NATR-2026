<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>NATR Purchase Form - Complete Working Version</title>
Â  Â  <style>
Â  Â    /* RESET AND BASE STYLES */
      * { 
          margin: 0; 
          padding: 0; 
          box-sizing: border-box; 
          /* Smooth transitions for all elements */
          transition: all 0.3s ease-in-out;
      }
      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          /* Dark, racing-themed gradient background (Black/Green blend) */
          background: linear-gradient(135deg, #0a0e1a 0%, #1a2f1a 50%, #0a0e1a 100%);
          color: white;
          padding: 20px;
          min-height: 100vh;
          /* Subtle Celtic pattern hook (can be added via background image or SVG) */
          background-image: radial-gradient(rgba(139, 195, 74, 0.1) 1px, transparent 1px);
          background-size: 20px 20px;
      }
      
      .container { 
          max-width: 900px; 
          margin: 0 auto; 
          display: grid;
          grid-template-columns: 2fr 1fr; /* Main content and Cart side-by-side */
          gap: 30px;
      }
      
      /* HEADER AND TYPOGRAPHY */
      .header { 
          text-align: center; 
          margin-bottom: 40px; 
          grid-column: 1 / -1; /* Header spans both columns */
      }
      .logo {
          width: 80px; 
          height: 80px;
          background: linear-gradient(135deg, #8bc34a, #689f38);
          border-radius: 50%; /* Changed to circle for a modern/coin look */
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 28px;
          font-weight: bold;
          color: #000;
          margin: 0 auto 20px;
          box-shadow: 0 0 25px rgba(139, 195, 74, 0.5);
          animation: pulse 2s infinite alternate; /* Pulsing logo effect */
      }
      @keyframes pulse {
          from { transform: scale(1); box-shadow: 0 0 25px rgba(139, 195, 74, 0.5); }
          to { transform: scale(1.05); box-shadow: 0 0 35px rgba(139, 195, 74, 0.8); }
      }
      
      h1 {
          font-size: 44px; /* Larger title */
          font-weight: 900;
          background: linear-gradient(135deg, #cddc39, #8bc34a, #cddc39);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-bottom: 5px;
          letter-spacing: 2px;
      }
      .subtitle { 
          color: #8bc34a; 
          font-size: 16px; 
          text-transform: uppercase; 
          letter-spacing: 3px; 
          font-weight: 600;
      }
      
      /* CARDS AND GLASS-MORPHISM */
      .main-content {
          grid-column: 1 / 2;
      }
      
      .form-card {
          /* Glass-Morphism Effect */
          background: rgba(255, 255, 255, 0.05);
          backdrop-filter: blur(20px);
          border: 1px solid rgba(139, 195, 74, 0.4);
          border-radius: 20px;
          padding: 30px;
          margin-bottom: 25px;
          box-shadow: 0 8px 32px 0 rgba(139, 195, 74, 0.1);
      }
      
      .section-title {
          color: #cddc39;
          font-size: 24px;
          margin-bottom: 25px;
          padding-bottom: 10px;
          border-bottom: 2px solid rgba(139, 195, 74, 0.3);
          font-weight: 700;
      }
      
      /* FORM ELEMENTS */
      .form-group { 
          margin-bottom: 20px; 
      }
      .form-label {
          display: block;
          font-size: 13px;
          font-weight: 600;
          margin-bottom: 8px;
          color: #8bc34a;
          text-transform: uppercase;
          letter-spacing: 1px;
      }
      .required { 
          color: #ff5722; 
          margin-left: 4px; 
      }
      .form-input, .form-select, textarea.form-input {
          width: 100%;
          padding: 12px;
          border: 1px solid rgba(139, 195, 74, 0.3);
          border-radius: 10px;
          background: rgba(0, 0, 0, 0.4);
          color: white;
          font-size: 16px;
          font-family: inherit;
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6);
      }
      .form-input:focus, .form-select:focus {
          outline: none;
          border-color: #cddc39;
          box-shadow: 0 0 10px rgba(205, 220, 57, 0.5);
      }
      .form-select {
          appearance: none;
          background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238bc34a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
          background-repeat: no-repeat;
          background-position: right 15px center;
          background-size: 20px;
          padding-right: 45px;
          cursor: pointer;
      }
      textarea.form-input { 
          min-height: 80px; 
          resize: vertical; 
      }
      .input-row { 
          display: grid; 
          grid-template-columns: 1fr 1fr; 
          gap: 15px; 
      }
      
      /* PURCHASE ITEMS LIST */
      .purchase-item {
          background: rgba(0, 0, 0, 0.3);
          border: 1px solid rgba(139, 195, 74, 0.2);
          border-radius: 15px;
          padding: 20px;
          margin-bottom: 15px;
          cursor: pointer;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      }
      .purchase-item:hover { 
          border-color: #8bc34a; 
          background: rgba(0, 0, 0, 0.5);
      }
      
      .item-header { 
          display: flex; 
          align-items: center; 
          margin-bottom: 10px; 
          cursor: pointer; 
      }
      .checkbox-custom { 
          width: 24px; 
          height: 24px; 
          margin-right: 15px; 
          accent-color: #8bc34a; 
          cursor: pointer; 
      }
      .item-title { 
          flex: 1; 
      }
      .item-name { 
          font-size: 18px; 
          font-weight: 700; 
          color: #cddc39; 
          margin-bottom: 2px; 
      }
      .item-price { 
          font-size: 14px; 
          opacity: 0.8; 
      }
      .inventory-badge {
          background: #ffc107;
          padding: 4px 10px;
          border-radius: 15px;
          font-size: 12px;
          font-weight: 700;
          color: #333;
          text-transform: uppercase;
      }
      .inventory-badge.sold-out { 
          background: #f44336; 
          color: white; 
      }
      
      .conditional-fields { 
          margin-top: 15px; 
          padding-top: 15px; 
          border-top: 1px solid rgba(139, 195, 74, 0.2); 
          display: none; 
          animation: fadeIn 0.5s;
      }
      .conditional-fields.visible { 
          display: block; 
      }
      
      .info-box {
          background: rgba(139, 195, 74, 0.1);
          border-left: 4px solid #8bc34a;
          padding: 12px;
          border-radius: 5px;
          margin: 10px 0;
      }
      .info-box p { 
          font-size: 13px; 
          line-height: 1.6; 
          opacity: 0.9; 
      }
      
      /* SHOPPING CART */
      .shopping-cart {
          grid-column: 2 / 3;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(30px);
          border: 2px solid #8bc34a;
          border-radius: 20px;
          padding: 25px;
          position: sticky;
          top: 20px;
          align-self: start;
          box-shadow: 0 10px 40px rgba(139, 195, 74, 0.3);
      }
      .cart-title { 
          font-size: 22px; 
          color: #cddc39; 
          margin-bottom: 20px; 
          text-align: center; 
          font-weight: 700;
      }
      .cart-items { 
          margin-bottom: 15px; 
      }
      .cart-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px 0;
          border-bottom: 1px dashed rgba(139, 195, 74, 0.2);
      }
      .cart-item:last-child { 
          border-bottom: none; 
      }
      .cart-item-name { 
          font-size: 14px; 
          opacity: 0.9; 
      }
      .cart-item-qty { 
          font-size: 12px; 
          opacity: 0.7; 
          margin-top: 2px; 
      }
      .cart-item-price { 
          font-size: 16px; 
          font-weight: 700; 
          color: #8bc34a; 
      }
      .cart-empty { 
          text-align: center; 
          opacity: 0.6; 
          padding: 20px 0; 
          font-size: 14px; 
      }
      .cart-totals { 
          margin-top: 15px; 
          padding-top: 15px; 
          border-top: 2px solid rgba(139, 195, 74, 0.3); 
      }
      .cart-total-row { 
          display: flex; 
          justify-content: space-between; 
          margin-bottom: 8px; 
          font-size: 15px;
      }
      .cart-total-row.final {
          font-size: 24px;
          font-weight: 900;
          color: #cddc39;
          margin-top: 15px;
          padding-top: 15px;
          border-top: 2px solid #8bc34a;
      }
      
      /* BUTTONS */
      .btn {
          width: 100%;
          padding: 15px;
          border: none;
          border-radius: 12px;
          font-size: 16px;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 1px;
          cursor: pointer;
      }
      .btn-primary {
          background: linear-gradient(135deg, #8bc34a, #689f38);
          color: #000;
          box-shadow: 0 5px 20px rgba(139, 195, 74, 0.4);
      }
      .btn-primary:hover:not(:disabled) { 
          transform: translateY(-2px); 
          box-shadow: 0 10px 25px rgba(139, 195, 74, 0.6); 
      }
      .btn-primary:disabled { 
          background: #666; 
          cursor: not-allowed; 
          opacity: 0.5; 
          box-shadow: none;
      }
      .btn-secondary { 
          background: rgba(139, 195, 74, 0.1); 
          border: 1px solid #8bc34a; 
          color: #8bc34a; 
          margin-top: 10px;
      }
      
      /* MEDIA QUERIES for Mobile */
      @media (max-width: 768px) {
          .container { 
              grid-template-columns: 1fr; /* Stack columns on mobile */
              gap: 20px;
          }
          .main-content, .shopping-cart {
              grid-column: 1 / -1;
          }
          .input-row { 
              grid-template-columns: 1fr; 
          }
          .form-card { 
              padding: 20px; 
          }
          h1 { 
              font-size: 36px; 
          }
          .shopping-cart {
              position: static; /* Unstick the cart on mobile */
          }
      }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <div class="logo">BC</div>
Â  Â  Â  Â  Â  Â  <h1>Purchase Form</h1>
Â  Â  Â  Â  Â  Â  <p class="subtitle">Night at the Races 2025</p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="form-card">
Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸ‘¤ Purchaser Information</h2>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Full Name<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="firstName" placeholder="First Name" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="lastName" placeholder="Last Name" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Email<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" class="form-input" id="email" placeholder="your.email@example.com" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Phone<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="tel" class="form-input" id="phone" placeholder="(216) 555-0123" required>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Dancer Family<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="dancerFamily" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="campbell">Campbell</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="murphy">Murphy</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="smith">Smith</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="kelly">Kelly</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="none">None (General Supporter)</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="form-card">
Â  Â  Â  Â  Â  Â  <h2 class="section-title">ğŸŸï¸ Items</h2>

Â  Â  Â  Â  Â  Â  <div class="purchase-item">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="checkbox-custom" id="eventTicketsCheck">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-name">ğŸŸï¸ Event Tickets</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-price">$25 per person</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="inventory-badge" id="ticketInventory">500/500 Available</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="conditional-fields" id="eventTicketsFields">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>Tickets are first-come, first-served (500 maximum capacity).</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Quantity</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="ticketQuantity">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let i = 1; i <= 15; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.write(`<option value="${i}">${i} - $${i*25}</option>`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group" id="tableReservationField" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Table Reservation Name (for 8+ tickets)<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="tableName" placeholder="Enter Table Name (e.g., The Murphy Family Table)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="purchase-item">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="checkbox-custom" id="horseSponsorshipCheck">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-name">ğŸ‡ Horse Sponsorship</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-price">$25 per horse</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="inventory-badge" id="horseInventory">90/90 Available</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="conditional-fields" id="horseSponsorshipFields">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>Horse sponsorships are first-come, first-served. Each horse will be randomly assigned to one of the 9 races.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Number of Horses to Sponsor</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="horseQuantity">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let i = 1; i <= 10; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.write(`<option value="${i}">${i} - $${i*25}</option>`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="horseEntriesContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="purchase-item">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="checkbox-custom" id="programAdCheck">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-name">ğŸ“– Program Book Ads</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-price">Starting at $25</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="conditional-fields" id="programAdFields">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>Ad Submission Deadline: **March 13th**</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="adsContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-secondary" id="addAdBtn" style="display:none; margin-top: 15px;">+ Add Another Ad</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="purchase-item">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="checkbox-custom" id="raffleTicketsCheck">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-name">ğŸ« Raffle Tickets</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-price">$5 each or Book of 5 for $20</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="conditional-fields" id="raffleTicketsFields">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Purchase Type</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="raffleType">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="individual">Individual Tickets ($5 each)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="book">Books of 5 Tickets ($20 per book)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="raffleIndividualOptions" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Number of Individual Tickets</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="raffleQuantityIndividual">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let i = 1; i <= 25; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.write(`<option value="${i}">${i} Tickets - $${i*5}</option>`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="raffleBookOptions" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Number of Books (5 tickets per book)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="raffleQuantityBook">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for(let i = 1; i <= 10; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.write(`<option value="${i}">${i} Book(s) (${i*5} Tickets) - $${i*20}</option>`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </script>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="raffleEntriesContainer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="purchase-item">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="checkbox-custom" id="basketDonationCheck">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-title">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-name">ğŸ§º Basket Raffle & Donation</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="item-price">Gift Basket or Cash Donation</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="conditional-fields" id="basketDonationFields">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Type of Donation</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="donationType">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="basket">Gift Basket (Physical Donation)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cash">Cash Donation</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="giftBasketFields" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Basket Theme / Description<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="form-input" id="basketDescription" placeholder="e.g., Wine & Cheese Lovers Basket"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Estimated Value<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="basketValue">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="50">Under $50</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="100">$50 - $100</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="200">$100 - $200</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="201">Over $200</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="cashDonationFields" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Cash Donation Amount<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" class="form-input" id="cashDonationAmount" placeholder="0.00" min="1" step="0.01">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Designate Purpose (Optional)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select" id="cashPurpose">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">General Fund</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="costumes">Costumes</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="competition">Competition Fees</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="scholarship">Scholarship Fund</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Recognition Name (Optional)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="recognitionName" placeholder="Name to be announced/listed">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="shopping-cart">
Â  Â  Â  Â  Â  Â  <h3 class="cart-title">ğŸ›’ Order Summary</h3>
Â  Â  Â  Â  Â  Â  <div class="cart-items" id="cartItems">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="cart-empty">Cart is empty</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="cart-totals" id="cartTotals" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="cart-total-row"><span>Subtotal:</span><span id="subtotal">$0.00</span></div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div style="background: rgba(139,195,74,0.05); border: 1px solid rgba(139,195,74,0.2); border-radius: 10px; padding: 15px; margin: 15px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="display: flex; cursor: pointer;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="coverFeesCheckbox" style="width: 20px; height: 20px; margin-right: 12px; accent-color: #8bc34a;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="flex: 1;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight: 600; font-size: 14px;">ğŸ’³ Help us by covering the processing fee</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="feeAmount" style="color: #8bc34a; font-weight: 600; margin-top: 8px; font-size: 13px;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="cart-total-row final"><span>Total:</span><span id="total">$0.00</span></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button class="btn btn-primary" id="checkoutBtn" disabled>Proceed to Checkout</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
<!-- hiding existing script -->
Â  Â  <script>
Â  Â  Â  Â  // --- JAVASCRIPT LOGIC ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  let cart = {
Â  Â  Â  Â  Â  Â  eventTickets: null,
Â  Â  Â  Â  Â  Â  horses: { quantity: 0, totalPrice: 0, entries: [] },
Â  Â  Â  Â  Â  Â  programAds: [],
Â  Â  Â  Â  Â  Â  raffleTickets: null,
Â  Â  Â  Â  Â  Â  donation: null,
Â  Â  Â  Â  Â  Â  cashDonation: null
Â  Â  Â  Â  };

Â  Â  Â  Â  const PRICES = {
Â  Â  Â  Â  Â  Â  TICKET: 25,
Â  Â  Â  Â  Â  Â  HORSE: 25,
Â  Â  Â  Â  Â  Â  RAFFLE_INDIVIDUAL: 5,
Â  Â  Â  Â  Â  Â  RAFFLE_BOOK: 20,
Â  Â  Â  Â  Â  Â  AD_BUSINESS_CARD: 25,
Â  Â  Â  Â  Â  Â  AD_QUARTER: 25,
Â  Â  Â  Â  Â  Â  AD_HALF: 50,
Â  Â  Â  Â  Â  Â  AD_FULL: 100,
Â  Â  Â  Â  Â  Â  AD_FULL_SPONSORED: 120,
Â  Â  Â  Â  Â  Â  FEE_PERCENT: 0.029,
Â  Â  Â  Â  Â  Â  FEE_FLAT: 0.30
Â  Â  Â  Â  };

Â  Â  Â  Â  const DOM = {
Â  Â  Â  Â  Â  Â  // Purchaser Info
Â  Â  Â  Â  Â  Â  firstName: document.getElementById('firstName'),
Â  Â  Â  Â  Â  Â  lastName: document.getElementById('lastName'),
Â  Â  Â  Â  Â  Â  email: document.getElementById('email'),
Â  Â  Â  Â  Â  Â  phone: document.getElementById('phone'),
Â  Â  Â  Â  Â  Â  dancerFamily: document.getElementById('dancerFamily'),

Â  Â  Â  Â  Â  Â  // Tickets
Â  Â  Â  Â  Â  Â  eventTicketsCheck: document.getElementById('eventTicketsCheck'),
Â  Â  Â  Â  Â  Â  eventTicketsFields: document.getElementById('eventTicketsFields'),
Â  Â  Â  Â  Â  Â  ticketQuantity: document.getElementById('ticketQuantity'),
Â  Â  Â  Â  Â  Â  tableReservationField: document.getElementById('tableReservationField'),
Â  Â  Â  Â  Â  Â  tableName: document.getElementById('tableName'),

Â  Â  Â  Â  Â  Â  // Horses
Â  Â  Â  Â  Â  Â  horseSponsorshipCheck: document.getElementById('horseSponsorshipCheck'),
Â  Â  Â  Â  Â  Â  horseSponsorshipFields: document.getElementById('horseSponsorshipFields'),
Â  Â  Â  Â  Â  Â  horseQuantity: document.getElementById('horseQuantity'),
Â  Â  Â  Â  Â  Â  horseEntriesContainer: document.getElementById('horseEntriesContainer'),

Â  Â  Â  Â  Â  Â  // Program Ads
Â  Â  Â  Â  Â  Â  programAdCheck: document.getElementById('programAdCheck'),
Â  Â  Â  Â  Â  Â  programAdFields: document.getElementById('programAdFields'),
Â  Â  Â  Â  Â  Â  adsContainer: document.getElementById('adsContainer'),
Â  Â  Â  Â  Â  Â  addAdBtn: document.getElementById('addAdBtn'),

Â  Â  Â  Â  Â  Â  // Raffle Tickets
Â  Â  Â  Â  Â  Â  raffleTicketsCheck: document.getElementById('raffleTicketsCheck'),
Â  Â  Â  Â  Â  Â  raffleTicketsFields: document.getElementById('raffleTicketsFields'),
Â  Â  Â  Â  Â  Â  raffleType: document.getElementById('raffleType'),
Â  Â  Â  Â  Â  Â  raffleQuantityIndividual: document.getElementById('raffleQuantityIndividual'),
Â  Â  Â  Â  Â  Â  raffleQuantityBook: document.getElementById('raffleQuantityBook'),
Â  Â  Â  Â  Â  Â  raffleIndividualOptions: document.getElementById('raffleIndividualOptions'),
Â  Â  Â  Â  Â  Â  raffleBookOptions: document.getElementById('raffleBookOptions'),
Â  Â  Â  Â  Â  Â  raffleEntriesContainer: document.getElementById('raffleEntriesContainer'),

Â  Â  Â  Â  Â  Â  // Donations
Â  Â  Â  Â  Â  Â  basketDonationCheck: document.getElementById('basketDonationCheck'),
Â  Â  Â  Â  Â  Â  basketDonationFields: document.getElementById('basketDonationFields'),
Â  Â  Â  Â  Â  Â  donationType: document.getElementById('donationType'),
Â  Â  Â  Â  Â  Â  giftBasketFields: document.getElementById('giftBasketFields'),
Â  Â  Â  Â  Â  Â  cashDonationFields: document.getElementById('cashDonationFields'),
Â  Â  Â  Â  Â  Â  basketDescription: document.getElementById('basketDescription'),
Â  Â  Â  Â  Â  Â  basketValue: document.getElementById('basketValue'),
Â  Â  Â  Â  Â  Â  cashDonationAmount: document.getElementById('cashDonationAmount'),
Â  Â  Â  Â  Â  Â  cashPurpose: document.getElementById('cashPurpose'),
Â  Â  Â  Â  Â  Â  recognitionName: document.getElementById('recognitionName'),

Â  Â  Â  Â  Â  Â  // Cart
Â  Â  Â  Â  Â  Â  cartItems: document.getElementById('cartItems'),
Â  Â  Â  Â  Â  Â  cartTotals: document.getElementById('cartTotals'),
Â  Â  Â  Â  Â  Â  subtotalDisplay: document.getElementById('subtotal'),
Â  Â  Â  Â  Â  Â  coverFeesCheckbox: document.getElementById('coverFeesCheckbox'),
Â  Â  Â  Â  Â  Â  feeAmountDisplay: document.getElementById('feeAmount'),
Â  Â  Â  Â  Â  Â  totalDisplay: document.getElementById('total'),
Â  Â  Â  Â  Â  Â  checkoutBtn: document.getElementById('checkoutBtn')
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- CORE FUNCTIONS ---

Â  Â  Â  Â  function updateCart() {
Â  Â  Â  Â  Â  Â  let html = '', subtotal = 0;
Â  Â  Â  Â  Â  Â  const itemCounts = { paid: 0, donated: 0 };

Â  Â  Â  Â  Â  Â  // 1. Event Tickets
Â  Â  Â  Â  Â  Â  if (cart.eventTickets && cart.eventTickets.quantity > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  subtotal += cart.eventTickets.total;
Â  Â  Â  Â  Â  Â  Â  Â  itemCounts.paid++;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="cart-item"><div><div class="cart-item-name">ğŸŸï¸ Event Tickets</div><div class="cart-item-qty">${cart.eventTickets.quantity} Ã— $${PRICES.TICKET}</div></div><div class="cart-item-price">$${cart.eventTickets.total.toFixed(2)}</div></div>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Horse Sponsorships
Â  Â  Â  Â  Â  Â  if (cart.horses.quantity > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  subtotal += cart.horses.totalPrice;
Â  Â  Â  Â  Â  Â  Â  Â  itemCounts.paid++;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="cart-item"><div><div class="cart-item-name">ğŸ‡ Horse Sponsorships</div><div class="cart-item-qty">${cart.horses.quantity} Horse(s)</div></div><div class="cart-item-price">$${cart.horses.totalPrice.toFixed(2)}</div></div>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 3. Program Ads
Â  Â  Â  Â  Â  Â  cart.programAds.forEach((ad, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (ad.price > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subtotal += ad.price;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemCounts.paid++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="cart-item"><div><div class="cart-item-name">ğŸ“– Program Ad #${index + 1}</div><div class="cart-item-qty">${ad.sizeLabel}</div></div><div class="cart-item-price">$${ad.price.toFixed(2)}</div></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // 4. Raffle Tickets
Â  Â  Â  Â  Â  Â  if (cart.raffleTickets && cart.raffleTickets.totalPrice > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  subtotal += cart.raffleTickets.totalPrice;
Â  Â  Â  Â  Â  Â  Â  Â  itemCounts.paid++;
Â  Â  Â  Â  Â  Â  Â  Â  const qtyText = cart.raffleTickets.type === 'book' ? `${cart.raffleTickets.books} Book(s) (${cart.raffleTickets.totalQuantity} Tix)` : `${cart.raffleTickets.totalQuantity} Individual Tix`;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="cart-item"><div><div class="cart-item-name">ğŸ« Raffle Tickets</div><div class="cart-item-qty">${qtyText}</div></div><div class="cart-item-price">$${cart.raffleTickets.totalPrice.toFixed(2)}</div></div>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 5. Cash Donation
Â  Â  Â  Â  Â  Â  if (cart.cashDonation && cart.cashDonation.amount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  subtotal += cart.cashDonation.amount;
Â  Â  Â  Â  Â  Â  Â  Â  itemCounts.paid++;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="cart-item"><div><div class="cart-item-name">ğŸ’µ Cash Donation</div><div class="cart-item-qty">${cart.cashDonation.purpose || 'General Fund'}</div></div><div class="cart-item-price">$${cart.cashDonation.amount.toFixed(2)}</div></div>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 6. Gift Basket Donation (No charge, but shows up)
Â  Â  Â  Â  Â  Â  if (cart.donation && cart.donation.type === 'basket') {
Â  Â  Â  Â  Â  Â  Â  Â  itemCounts.donated++;
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="cart-item"><div><div class="cart-item-name">ğŸ§º Gift Basket Donation</div><div class="cart-item-qty">Value: ${cart.donation.valueLabel}</div></div><div class="cart-item-price">Thank you!</div></div>`;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Update Cart UI
Â  Â  Â  Â  Â  Â  DOM.cartItems.innerHTML = html || '<div class="cart-empty">Cart is empty</div>';
Â  Â  Â  Â  Â  Â  DOM.cartTotals.style.display = (itemCounts.paid > 0 || itemCounts.donated > 0) ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  DOM.subtotalDisplay.textContent = `$${subtotal.toFixed(2)}`;
Â  Â  Â  Â  Â  Â  DOM.checkoutBtn.disabled = itemCounts.paid === 0; // Disable if only basket donation
Â  Â  Â  Â  Â  Â  updateTotal(subtotal);

Â  Â  Â  Â  Â  Â  // Hide/Show Fee option if there is no subtotal
Â  Â  Â  Â  Â  Â  DOM.coverFeesCheckbox.closest('div').style.display = subtotal > 0 ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  // Re-render conditional Horse/Ad fields which rely on cart data
Â  Â  Â  Â  Â  Â  updateHorseFields();Â 
Â  Â  Â  Â  Â  Â  // This call to updateRaffleFields is NECESSARY to update its internal UI/data
Â  Â  Â  Â  Â  Â  updateRaffleFields();
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateTotal(subtotal) {
Â  Â  Â  Â  Â  Â  const coverFees = DOM.coverFeesCheckbox.checked;
Â  Â  Â  Â  Â  Â  let fee = 0, total = subtotal;

Â  Â  Â  Â  Â  Â  if (coverFees && subtotal > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  fee = (subtotal * PRICES.FEE_PERCENT) + PRICES.FEE_FLAT;
Â  Â  Â  Â  Â  Â  Â  Â  total = subtotal + fee;
Â  Â  Â  Â  Â  Â  Â  Â  DOM.feeAmountDisplay.textContent = `Fee: $${fee.toFixed(2)}`;
Â  Â  Â  Â  Â  Â  Â  Â  DOM.feeAmountDisplay.style.display = 'block';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  DOM.feeAmountDisplay.style.display = 'none';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  DOM.totalDisplay.textContent = `$${total.toFixed(2)}`;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- VALIDATION LOGIC ---

Â  Â  Â  Â  function validateEmail(email) {
Â  Â  Â  Â  Â  Â  const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
Â  Â  Â  Â  Â  Â  return re.test(String(email).toLowerCase());
Â  Â  Â  Â  }

Â  Â  Â  Â  function validateForm() {
Â  Â  Â  Â  Â  Â  let isValid = true;
Â  Â  Â  Â  Â  Â  let firstErrorElement = null;

Â  Â  Â  Â  Â  Â  // Simple required fields (Name, Email, Phone, Family)
Â  Â  Â  Â  Â  Â  const requiredFields = [DOM.firstName, DOM.lastName, DOM.email, DOM.phone, DOM.dancerFamily];
Â  Â  Â  Â  Â  Â  requiredFields.forEach(field => {
Â  Â  Â  Â  Â  Â  Â  Â  if (field.value.trim() === '' || (field.type === 'email' && !validateEmail(field.value))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  field.style.borderColor = '#ff5722';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!firstErrorElement) firstErrorElement = field;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  field.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Conditional validation
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Event Tickets: Table name check
Â  Â  Â  Â  Â  Â  if (cart.eventTickets && cart.eventTickets.quantity >= 8 && DOM.tableName.value.trim() === '') {
Â  Â  Â  Â  Â  Â  Â  Â  DOM.tableName.style.borderColor = '#ff5722';
Â  Â  Â  Â  Â  Â  Â  Â  if (!firstErrorElement) firstErrorElement = DOM.tableName;
Â  Â  Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  Â  Â  } else if (DOM.tableName) {
Â  Â  Â  Â  Â  Â  Â  Â  Â DOM.tableName.style.borderColor = '';
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Horse Sponsorships: Horse names/owners check
Â  Â  Â  Â  Â  Â  if (cart.horses.quantity > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  cart.horses.entries.forEach((entry, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const horseNameField = document.getElementById(`horse-name-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ownerNameField = document.getElementById(`owner-name-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (horseNameField.value.trim() === '' || ownerNameField.value.trim() === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (horseNameField.value.trim() === '') horseNameField.style.borderColor = '#ff5722'; else horseNameField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ownerNameField.value.trim() === '') ownerNameField.style.borderColor = '#ff5722'; else ownerNameField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!firstErrorElement) firstErrorElement = horseNameField || ownerNameField;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  horseNameField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ownerNameField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Program Ads: Logic check
Â  Â  Â  Â  Â  Â  if (cart.programAds.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â cart.programAds.forEach((ad, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const adContainer = document.getElementById(`ad-container-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const adSize = adContainer.querySelector('.ad-size-select');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const adBusinessName = adContainer.querySelector('.ad-business-name');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const adDesignOption = adContainer.querySelector('.ad-design-option');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (adSize.value === '' || adBusinessName.value.trim() === '' || adDesignOption.value === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adSize.style.borderColor = adSize.value === '' ? '#ff5722' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adBusinessName.style.borderColor = adBusinessName.value.trim() === '' ? '#ff5722' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adDesignOption.style.borderColor = adDesignOption.value === '' ? '#ff5722' : '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!firstErrorElement) firstErrorElement = adSize || adBusinessName || adDesignOption;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adSize.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adBusinessName.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adDesignOption.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Cash Donation Check
Â  Â  Â  Â  Â  Â  if (DOM.donationType.value === 'cash' && (parseFloat(DOM.cashDonationAmount.value) || 0) <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â DOM.cashDonationAmount.style.borderColor = '#ff5722';
Â  Â  Â  Â  Â  Â  Â  Â  Â if (!firstErrorElement) firstErrorElement = DOM.cashDonationAmount;
Â  Â  Â  Â  Â  Â  Â  Â  Â isValid = false;
Â  Â  Â  Â  Â  Â  } else if (DOM.cashDonationAmount) {
Â  Â  Â  Â  Â  Â  Â  Â  Â DOM.cashDonationAmount.style.borderColor = '';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Raffle Tickets check (complex: needs name/contact for every ticket/book)
Â  Â  Â  Â  Â  Â  if (cart.raffleTickets && cart.raffleTickets.entries.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  cart.raffleTickets.entries.forEach((entry, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ownerNameField = document.getElementById(`raffle-name-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const contactField = document.getElementById(`raffle-contact-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ownerNameField.value.trim() === '' || contactField.value.trim() === '') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (ownerNameField.value.trim() === '') ownerNameField.style.borderColor = '#ff5722'; else ownerNameField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (contactField.value.trim() === '') contactField.style.borderColor = '#ff5722'; else contactField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!firstErrorElement) firstErrorElement = ownerNameField || contactField;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ownerNameField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contactField.style.borderColor = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (!isValid && firstErrorElement) {
Â  Â  Â  Â  Â  Â  Â  Â  firstErrorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
Â  Â  Â  Â  Â  Â  Â  Â  // Changed from alert() to a temporary visual cue as per best practices
Â  Â  Â  Â  Â  Â  Â  Â  // alert('Please correct the highlighted fields before proceeding.');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return isValid;
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- HORSE LOGIC ---

Â  Â  Â  Â  function generateHorseEntryHTML(index) {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="horse-entry">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>ğŸ‡ Horse #${index + 1}</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Horse Name<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input horse-name-input" id="horse-name-${index}" placeholder="e.g., Irish Charger">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Owner Name (for Announcement)<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input owner-name-input" id="owner-name-${index}" placeholder="e.g., The Murphy Family">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateHorseFields() {
Â  Â  Â  Â  Â  Â  const qty = cart.horses.quantity;
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â  cart.horses.entries = []; // Reset entries

Â  Â  Â  Â  Â  Â  for (let i = 0; i < qty; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  html += generateHorseEntryHTML(i);
Â  Â  Â  Â  Â  Â  Â  Â  // Create placeholders for data submission
Â  Â  Â  Â  Â  Â  Â  Â  cart.horses.entries.push({ number: i + 1, name: '', owner: '' });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  DOM.horseEntriesContainer.innerHTML = html;
Â  Â  Â  Â  }

Â  Â  Â  Â  DOM.horseSponsorshipCheck.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  DOM.horseSponsorshipFields.classList.toggle('visible', this.checked);
Â  Â  Â  Â  Â  Â  if (!this.checked) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  DOM.horseQuantity.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  cart.horses = { quantity: 0, totalPrice: 0, entries: [] };Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.horseQuantity.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  const qty = parseInt(this.value) || 0;
Â  Â  Â  Â  Â  Â  cart.horses.quantity = qty;
Â  Â  Â  Â  Â  Â  cart.horses.totalPrice = qty * PRICES.HORSE;
Â  Â  Â  Â  Â  Â  updateHorseFields();
Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Event listener for all dynamically added horse name/owner fields
Â  Â  Â  Â  DOM.horseEntriesContainer.addEventListener('input', function(e) {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('horse-name-input') || e.target.classList.contains('owner-name-input')) {
Â  Â  Â  Â  Â  Â  Â  Â  // Find the index from the element's ID (e.g., horse-name-0 -> 0)
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.id.split('-').pop());
Â  Â  Â  Â  Â  Â  Â  Â  const horseEntry = cart.horses.entries[index];

Â  Â  Â  Â  Â  Â  Â  Â  if (horseEntry) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('horse-name-input')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  horseEntry.name = e.target.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (e.target.classList.contains('owner-name-input')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  horseEntry.owner = e.target.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });


Â  Â  Â  Â  // --- PROGRAM AD LOGIC ---
Â  Â  Â  Â  let adCount = 0;

Â  Â  Â  Â  function getAdPriceAndLabel(value) {
Â  Â  Â  Â  Â  Â  switch (value) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'business-card-25': return { price: PRICES.AD_BUSINESS_CARD, sizeLabel: 'Business Card (Â¼ page)' };
Â  Â  Â  Â  Â  Â  Â  Â  case 'quarter-25': return { price: PRICES.AD_QUARTER, sizeLabel: 'Â¼ Page' };
Â  Â  Â  Â  Â  Â  Â  Â  case 'half-50': return { price: PRICES.AD_HALF, sizeLabel: 'Â½ Page' };
Â  Â  Â  Â  Â  Â  Â  Â  case 'full-100': return { price: PRICES.AD_FULL, sizeLabel: 'Full Page' };
Â  Â  Â  Â  Â  Â  Â  Â  case 'full-sponsored-120': return { price: PRICES.AD_FULL_SPONSORED, sizeLabel: 'Full Page + Sponsored Race' };
Â  Â  Â  Â  Â  Â  Â  Â  default: return { price: 0, sizeLabel: '' };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function generateAdHTML(index) {
Â  Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="ad-container" id="ad-container-${index}" data-ad-index="${index}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${index > 0 ? `<span class="remove-btn" onclick="removeAd(${index})">Remove Ad #${index + 1}</span>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>ğŸ“– **Ad #${index + 1}**</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Ad Size & Price<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select ad-size-select" data-index="${index}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select Size</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="business-card-25">$25 - Business Card (Â¼ page)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="quarter-25">$25 - Â¼ Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="half-50">$50 - Â½ Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="full-100">$100 - Full Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="full-sponsored-120">$120 - Full Page + Sponsored Race</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Business / Purchaser Name<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input ad-business-name" data-index="${index}" placeholder="Name for Program Book">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Ad Design Option<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="form-select ad-design-option" data-index="${index}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="">Select Option</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="upload">I'll Design & Upload My Own Ad</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="create">Please Create an Ad for Me</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ad-upload-field" data-index="${index}" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>Upload your PDF, JPG, or PNG file here.</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Upload Graphic</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" class="form-input ad-file-upload" data-index="${index}" accept=".pdf,.jpg,.jpeg,.png">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ad-create-field" data-index="${index}" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Ad Content / Instructions</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea class="form-input ad-content-instructions" data-index="${index}" placeholder="e.g., Use logo attached and text: 'Proud Sponsor of the BC Dancers!'"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  }

Â  Â  Â  Â  function addAd() {
Â  Â  Â  Â  Â  Â  if (cart.programAds.length >= 5) return; // Max 5 ads

Â  Â  Â  Â  Â  Â  const index = cart.programAds.length;
Â  Â  Â  Â  Â  Â  cart.programAds.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  adNumber: index + 1, price: 0, sizeLabel: '', businessName: '', designOption: '',Â 
Â  Â  Â  Â  Â  Â  Â  Â  file: null, instructions: ''
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  DOM.adsContainer.insertAdjacentHTML('beforeend', generateAdHTML(index));

Â  Â  Â  Â  Â  Â  // Show/Hide 'Add Another Ad' button
Â  Â  Â  Â  Â  Â  DOM.addAdBtn.style.display = cart.programAds.length < 5 ? 'block' : 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  function removeAd(index) {
Â  Â  Â  Â  Â  Â  cart.programAds.splice(index, 1);
Â  Â  Â  Â  Â  Â  const adElement = document.getElementById(`ad-container-${index}`);
Â  Â  Â  Â  Â  Â  if (adElement) adElement.remove();

Â  Â  Â  Â  Â  Â  // Re-index remaining ads in the cart and DOM
Â  Â  Â  Â  Â  Â  cart.programAds.forEach((ad, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  ad.adNumber = i + 1;
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById(`ad-container-${ad.adIndex}`);
Â  Â  Â  Â  Â  Â  Â  Â  if (container) container.id = `ad-container-${i}`;
Â  Â  Â  Â  Â  Â  Â  Â  ad.adIndex = i;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  adCount = cart.programAds.length;

Â  Â  Â  Â  Â  Â  DOM.addAdBtn.style.display = cart.programAds.length < 5 ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  }

Â  Â  Â  Â  DOM.programAdCheck.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  DOM.programAdFields.classList.toggle('visible', this.checked);
Â  Â  Â  Â  Â  Â  if (this.checked && cart.programAds.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  addAd();
Â  Â  Â  Â  Â  Â  } else if (!this.checked) {
Â  Â  Â  Â  Â  Â  Â  Â  DOM.adsContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  cart.programAds = [];
Â  Â  Â  Â  Â  Â  Â  Â  DOM.addAdBtn.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.addAdBtn.addEventListener('click', addAd);

Â  Â  Â  Â  // Event listener for all dynamically added ad fields
Â  Â  Â  Â  DOM.programAdFields.addEventListener('change', function(e) {
Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  const index = parseInt(target.getAttribute('data-index'));
Â  Â  Â  Â  Â  Â  const ad = cart.programAds[index];
Â  Â  Â  Â  Â  Â  if (!ad) return;

Â  Â  Â  Â  Â  Â  if (target.classList.contains('ad-size-select')) {
Â  Â  Â  Â  Â  Â  Â  Â  const { price, sizeLabel } = getAdPriceAndLabel(target.value);
Â  Â  Â  Â  Â  Â  Â  Â  ad.price = price;
Â  Â  Â  Â  Â  Â  Â  Â  ad.sizeLabel = sizeLabel;
Â  Â  Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  Â  Â  } else if (target.classList.contains('ad-design-option')) {
Â  Â  Â  Â  Â  Â  Â  Â  ad.designOption = target.value;
Â  Â  Â  Â  Â  Â  Â  Â  const adContainer = document.getElementById(`ad-container-${index}`);
Â  Â  Â  Â  Â  Â  Â  Â  if (adContainer) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adContainer.querySelector('.ad-upload-field').style.display = (target.value === 'upload') ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  adContainer.querySelector('.ad-create-field').style.display = (target.value === 'create') ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (target.classList.contains('ad-file-upload')) {
Â  Â  Â  Â  Â  Â  Â  Â  ad.file = target.files[0] || null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.programAdFields.addEventListener('input', function(e) {
Â  Â  Â  Â  Â  Â  const target = e.target;
Â  Â  Â  Â  Â  Â  const index = parseInt(target.getAttribute('data-index'));
Â  Â  Â  Â  Â  Â  const ad = cart.programAds[index];
Â  Â  Â  Â  Â  Â  if (!ad) return;

Â  Â  Â  Â  Â  Â  if (target.classList.contains('ad-business-name')) {
Â  Â  Â  Â  Â  Â  Â  Â  ad.businessName = target.value.trim();
Â  Â  Â  Â  Â  Â  } else if (target.classList.contains('ad-content-instructions')) {
Â  Â  Â  Â  Â  Â  Â  Â  ad.instructions = target.value.trim();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });


Â  Â  Â  Â  // --- RAFFLE TICKET LOGIC ---

  /* updating updateRaffleFileds() function
Â  Â  function updateRaffleFields() {
Â  Â  const type = DOM.raffleType.value;
Â  Â  const isIndividual = type === 'individual';
Â  Â  const isBook = type === 'book';

Â  Â  DOM.raffleIndividualOptions.style.display = isIndividual ? 'block' : 'none';
Â  Â  DOM.raffleBookOptions.style.display = isBook ? 'block' : 'none';
Â  Â Â 
Â  Â  // FIX: Check if raffleTickets exists before accessing (Good practice, kept)
Â  Â  if (!cart.raffleTickets) {
Â  Â  Â  Â  cart.raffleTickets = {Â 
Â  Â  Â  Â  Â  Â  type: '',Â 
Â  Â  Â  Â  Â  Â  individualTickets: 0,Â 
Â  Â  Â  Â  Â  Â  books: 0,Â 
Â  Â  Â  Â  Â  Â  totalQuantity: 0,Â 
Â  Â  Â  Â  Â  Â  totalPrice: 0,Â 
Â  Â  Â  Â  Â  Â  entries: []Â 
Â  Â  Â  Â  };
Â  Â  }
Â  Â Â 
Â  Â  const qty = isIndividual ? (parseInt(DOM.raffleQuantityIndividual.value) || 0) :Â 
Â  Â  Â  Â  Â  Â  Â  Â  isBook ? (parseInt(DOM.raffleQuantityBook.value) || 0) : 0;
Â  Â Â 
Â  Â  let totalEntries = 0;
Â  Â  let totalTickets = 0;
Â  Â  let html = '';
Â  Â  cart.raffleTickets.entries = []; // Now safe to reset

Â  Â  if (isIndividual) {
Â  Â  Â  Â  totalEntries = qty;
Â  Â  Â  Â  totalTickets = qty;
Â  Â  } else if (isBook) {
Â  Â  Â  Â  totalEntries = qty;
Â  Â  Â  Â  totalTickets = qty * 5;
Â  Â  }

Â  Â  for (let i = 0; i < totalEntries; i++) {
Â  Â  Â  Â  const ticketsPerEntry = isBook ? 5 : 1;
Â  Â  Â  Â  const entryLabel = isBook ? `Book #${i + 1} (${ticketsPerEntry} Tickets)` : `Ticket #${i + 1}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  <div class="horse-entry">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="info-box"><p>ğŸ« ${entryLabel}</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Owner's Full Name<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input raffle-name-input" id="raffle-name-${i}" placeholder="Name for Ticket(s)">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Owner's Contact (Email/Phone)<span class="required">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input raffle-contact-input" id="raffle-contact-${i}" placeholder="Email or Phone">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  cart.raffleTickets.entries.push({Â 
Â  Â  Â  Â  Â  Â  number: i + 1, name: '', contact: '',Â 
Â  Â  Â  Â  Â  Â  tickets: ticketsPerEntry
Â  Â  Â  Â  });
Â  Â  }

Â  Â  DOM.raffleEntriesContainer.innerHTML = html;

Â  Â  cart.raffleTickets.type = type;
Â  Â  cart.raffleTickets.individualTickets = isIndividual ? qty : 0;
Â  Â  cart.raffleTickets.books = isBook ? qty : 0;
Â  Â  cart.raffleTickets.totalQuantity = totalTickets;
Â  Â  cart.raffleTickets.totalPrice = (isIndividual ? qty * PRICES.RAFFLE_INDIVIDUAL : isBook ? qty * PRICES.RAFFLE_BOOK : 0);
Â  Â Â 
Â  Â  // updateCart(); // <-- REMOVED: This was the source of the infinite recursion
}

Â  Â  Â  Â  DOM.raffleTicketsCheck.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  DOM.raffleTicketsFields.classList.toggle('visible', this.checked);
Â  Â  Â  Â  Â  Â  if (!this.checked) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  DOM.raffleType.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.raffleQuantityIndividual.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.raffleQuantityBook.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  cart.raffleTickets = null;Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â cart.raffleTickets = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: '', individualTickets: 0, books: 0,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalQuantity: 0, totalPrice: 0, entries: []Â 
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // Called directly to initialize fields/cart data
Â  Â  Â  Â  Â  Â  updateRaffleFields();
Â  Â  Â  Â  Â  Â  // Now call updateCart to recalculate totals and re-run updateRaffleFields from cart update
Â  Â  Â  Â  Â  Â  updateCart(); 
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.raffleType.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  DOM.raffleQuantityIndividual.value = ''; // Clear other quantity
Â  Â  Â  Â  Â  Â  DOM.raffleQuantityBook.value = ''; // Clear other quantity
Â  Â  Â  Â  Â  Â  updateRaffleFields();
Â  Â  Â  Â  Â  Â  updateCart(); // Need to call cart update here since updateRaffleFields no longer calls it
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.raffleQuantityIndividual.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  updateRaffleFields();
Â  Â  Â  Â  Â  Â  updateCart(); // Need to call cart update here since updateRaffleFields no longer calls it
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.raffleQuantityBook.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  updateRaffleFields();
Â  Â  Â  Â  Â  Â  updateCart(); // Need to call cart update here since updateRaffleFields no longer calls it
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Event listener for all dynamically added raffle name/contact fields
Â  Â  Â  Â  DOM.raffleEntriesContainer.addEventListener('input', function(e) {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('raffle-name-input') || e.target.classList.contains('raffle-contact-input')) {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.id.split('-').pop());
Â  Â  Â  Â  Â  Â  Â  Â  const entry = cart.raffleTickets.entries[index];

Â  Â  Â  Â  Â  Â  Â  Â  if (entry) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('raffle-name-input')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entry.name = e.target.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (e.target.classList.contains('raffle-contact-input')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  entry.contact = e.target.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
      */
      function updateRaffleFields() {
        const type = DOM.raffleType.value;
        const isIndividual = type === 'individual';
        const isBook = type === 'book';
        
        // Toggle visibility of the correct input sections
        DOM.raffleIndividualOptions.style.display = isIndividual ? 'block' : 'none';
        DOM.raffleBookOptions.style.display = isBook ? 'block' : 'none';
    
        // Ensure the cart object is initialized before use (THE FIX)
        if (!cart.raffleTickets) {
            cart.raffleTickets = { 
                type: '', 
                individualTickets: 0, 
                books: 0, 
                totalQuantity: 0, 
                totalPrice: 0, 
                entries: [] 
            };
        }
    
        // Get selected quantity
        const qty = isIndividual 
            ? (parseInt(DOM.raffleQuantityIndividual.value) || 0) 
            : isBook 
            ? (parseInt(DOM.raffleQuantityBook.value) || 0) 
            : 0;
    
        let totalEntries = 0;
        let totalTickets = 0;
        let html = '';
        
        // Reset entries array (now safe)
        cart.raffleTickets.entries = []; 
        
        if (isIndividual) {
            totalEntries = qty;
            totalTickets = qty;
        } else if (isBook) {
            totalEntries = qty;
            totalTickets = qty * 5;
        }
    
        // Generate dynamic fields for name/contact
        for (let i = 0; i < totalEntries; i++) {
            const ticketsPerEntry = isBook ? 5 : 1;
            const entryLabel = isBook ? `Book #${i + 1} (${ticketsPerEntry} Tickets)` : `Ticket #${i + 1}`;
            
            html += `
                <div class="horse-entry">
                    <div class="info-box"><p>ğŸ« ${entryLabel}</p></div>
                    <div class="form-group">
                        <label class="form-label">Owner's Full Name<span class="required">*</span></label>
                        <input type="text" class="form-input raffle-name-input" id="raffle-name-${i}" placeholder="Name for Ticket(s)">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Owner's Contact (Email/Phone)<span class="required">*</span></label>
                        <input type="text" class="form-input raffle-contact-input" id="raffle-contact-${i}" placeholder="Email or Phone">
                    </div>
                </div>
            `;
            // Store entry structure
            cart.raffleTickets.entries.push({ 
                number: i + 1, name: '', contact: '', 
                tickets: ticketsPerEntry
            });
        }
    
        DOM.raffleEntriesContainer.innerHTML = html;
        
        // Update cart object with final values
        cart.raffleTickets.type = type;
        cart.raffleTickets.individualTickets = isIndividual ? qty : 0;
        cart.raffleTickets.books = isBook ? qty : 0;
        cart.raffleTickets.totalQuantity = totalTickets;
        cart.raffleTickets.totalPrice = (isIndividual ? qty * PRICES.RAFFLE_INDIVIDUAL : isBook ? qty * PRICES.RAFFLE_BOOK : 0);
        
        // Bind event listeners to the new input fields
        DOM.raffleEntriesContainer.querySelectorAll('.raffle-name-input, .raffle-contact-input').forEach(input => {
            input.addEventListener('input', () => validateForm(false)); // Don't show alert on input
        });
        
        updateCart();
    }

Â  Â  Â  Â  // --- DONATION LOGIC ---

Â  Â  Â  Â  function updateDonationFields() {
Â  Â  Â  Â  Â  Â  const type = DOM.donationType.value;
Â  Â  Â  Â  Â  Â  DOM.giftBasketFields.style.display = (type === 'basket') ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  DOM.cashDonationFields.style.display = (type === 'cash') ? 'block' : 'none';

Â  Â  Â  Â  Â  Â  if (type === 'basket') {
Â  Â  Â  Â  Â  Â  Â  Â  cart.donation = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'basket',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  description: DOM.basketDescription.value.trim(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value: DOM.basketValue.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  valueLabel: DOM.basketValue.options[DOM.basketValue.selectedIndex].text,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition: DOM.recognitionName.value.trim()
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  cart.cashDonation = null; // Clear cash donation if basket is selected
Â  Â  Â  Â  Â  Â  Â  Â  DOM.cashDonationAmount.value = '';
Â  Â  Â  Â  Â  Â  } else if (type === 'cash') {
Â  Â  Â  Â  Â  Â  Â  Â  const amount = parseFloat(DOM.cashDonationAmount.value) || 0;
Â  Â  Â  Â  Â  Â  Â  Â  cart.cashDonation = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: amount,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  purpose: DOM.cashPurpose.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition: DOM.recognitionName.value.trim()
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  cart.donation = null; // Clear basket donation if cash is selected
Â  Â  Â  Â  Â  Â  Â  Â  DOM.basketDescription.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.basketValue.value = '';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  cart.donation = null;
Â  Â  Â  Â  Â  Â  Â  Â  cart.cashDonation = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  }

Â  Â  Â  Â  DOM.basketDonationCheck.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  DOM.basketDonationFields.classList.toggle('visible', this.checked);
Â  Â  Â  Â  Â  Â  if (!this.checked) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  DOM.donationType.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.giftBasketFields.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.cashDonationFields.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  cart.donation = null;
Â  Â  Â  Â  Â  Â  Â  Â  cart.cashDonation = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateDonationFields();
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.donationType.addEventListener('change', updateDonationFields);
Â  Â  Â  Â  DOM.cashDonationAmount.addEventListener('input', updateDonationFields);
Â  Â  Â  Â  DOM.basketDescription.addEventListener('input', updateDonationFields);
Â  Â  Â  Â  DOM.basketValue.addEventListener('change', updateDonationFields);
Â  Â  Â  Â  DOM.cashPurpose.addEventListener('change', updateDonationFields);
Â  Â  Â  Â  DOM.recognitionName.addEventListener('input', updateDonationFields);


Â  Â  Â  Â  // --- EVENT TICKET LOGIC ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  DOM.eventTicketsCheck.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  DOM.eventTicketsFields.classList.toggle('visible', this.checked);
Â  Â  Â  Â  Â  Â  if (!this.checked) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  DOM.ticketQuantity.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.tableName.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  DOM.tableReservationField.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  cart.eventTickets = null;Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  });

Â  Â  Â  Â  DOM.ticketQuantity.addEventListener('change', function() {
Â  Â  Â  Â  Â  Â  const qty = parseInt(this.value) || 0;
Â  Â  Â  Â  Â  Â  cart.eventTickets = qty > 0 ? { quantity: qty, price: PRICES.TICKET, total: qty * PRICES.TICKET, tableName: DOM.tableName.value.trim() } : null;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Conditional Table Reservation Field
Â  Â  Â  Â  Â  Â  DOM.tableReservationField.style.display = (qty >= 8) ? 'block' : 'none';
Â  Â  Â  Â  Â  Â  if (qty < 8) DOM.tableName.value = ''; // Clear if requirement is gone

Â  Â  Â  Â  Â  Â  updateCart();
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  DOM.tableName.addEventListener('input', function() {
Â  Â  Â  Â  Â  Â  if (cart.eventTickets) {
Â  Â  Â  Â  Â  Â  Â  Â  cart.eventTickets.tableName = this.value.trim();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- FINAL CHECKOUT BINDING ---

// Remove validation popups - only show errors on checkout
[DOM.firstName, DOM.lastName, DOM.email, DOM.phone, DOM.dancerFamily].forEach(field => {
Â  Â  field.addEventListener('input', () => {
Â  Â  Â  Â  // Just remove error styling when typing
Â  Â  Â  Â  field.style.borderColor = '';
Â  Â  });
});

DOM.coverFeesCheckbox.addEventListener('change', function() {
Â  Â  const subtotal = parseFloat(DOM.subtotalDisplay.textContent.replace('$', '')) || 0;
Â  Â  updateTotal(subtotal);
});

// CHECKOUT BUTTON HANDLER
DOM.checkoutBtn.addEventListener('click', async function() {
Â  Â  // Validate form - only shows alerts if invalid
Â  Â  if (!validateForm()) {
Â  Â  Â  Â  // Using a simple alert, since you were using it previously.
Â  Â  Â  Â  alert('âŒ Please fill in all required fields before proceeding.');
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // Collect essential purchaser and totals data
Â  Â  const purchaserInfo = {
Â  Â  Â  Â  firstName: DOM.firstName.value.trim(),
Â  Â  Â  Â  lastName: DOM.lastName.value.trim(),
Â  Â  Â  Â  email: DOM.email.value.trim(),
Â  Â  Â  Â  phone: DOM.phone.value.trim(),
Â  Â  Â  Â  dancerFamily: DOM.dancerFamily.value,
Â  Â  Â  Â  subtotal: parseFloat(DOM.subtotalDisplay.textContent.replace('$', '')),
Â  Â  Â  Â  total: parseFloat(DOM.totalDisplay.textContent.replace('$', '')),
Â  Â  Â  Â  coverFees: DOM.coverFeesCheckbox.checked,
Â  Â  };
Â  Â Â 
Â  Â  const purchaseData = {
Â  Â  Â  Â  purchaser: purchaserInfo,
Â  Â  Â  Â  cart: cart,
Â  Â  Â  Â  totals: {
Â  Â  Â  Â  Â  Â  subtotal: purchaserInfo.subtotal,
Â  Â  Â  Â  Â  Â  coveringFees: purchaserInfo.coverFees,
Â  Â  Â  Â  Â  Â  processingFee: purchaserInfo.coverFees ? ((purchaserInfo.subtotal * PRICES.FEE_PERCENT) + PRICES.FEE_FLAT) : 0,
Â  Â  Â  Â  Â  Â  finalTotal: purchaserInfo.total
Â  Â  Â  Â  }
Â  Â  };

Â  Â  console.log('âœ… Validation passed - Creating Stripe checkout');
Â  Â  console.log('ğŸ“¦ Purchase data:', purchaseData);

Â  Â  // Disable button and show loading
Â  Â  const btn = this;
Â  Â  btn.disabled = true;
Â  Â  btn.textContent = 'Processing...';

Â  Â  try {
Â  Â  Â  Â  // --- FIX FOR METADATA OVERFLOW ---
Â  Â  Â  Â  // Create a small, summary version of the cart for Stripe metadata
Â  Â  Â  Â  // This ensures the total metadata size stays under the 500-character limit.
Â  Â  Â  Â  const summaryCart = {
Â  Â  Â  Â  Â  Â  tickets: cart.eventTickets?.quantity || 0,
Â  Â  Â  Â  Â  Â  horses: cart.horses?.quantity || 0,
Â  Â  Â  Â  Â  Â  ads: cart.programAds.length,
Â  Â  Â  Â  Â  Â  raffles: cart.raffleTickets?.totalQuantity || 0,
Â  Â  Â  Â  Â  Â  donation: cart.cashDonation?.amount || 0,
Â  Â  Â  Â  Â  Â  total: purchaseData.totals.finalTotal,
Â  Â  Â  Â  Â  Â  family: purchaseData.purchaser.dancerFamily
Â  Â  Â  Â  };
Â  Â  Â  Â  
Â  Â  Â  Â  // Update the purchaseData object to only include the summary cart for metadata purposes
Â  Â  Â  Â  // NOTE: The full 'cart' object is still sent to the Netlify function, where it can be saved/logged.
Â  Â  Â  Â  purchaseData.metadataSummary = JSON.stringify(summaryCart);
Â  Â  Â  Â  // --- END METADATA FIX ---


Â  Â  Â  Â  // Send data to Netlify function
Â  Â  Â  Â  console.log('ğŸŒ Calling Netlify function...');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const response = await fetch('/.netlify/functions/create-checkout', {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(purchaseData)
Â  Â  Â  Â  });

Â  Â  Â  Â  console.log('ğŸ“¡ Response status:', response.status);

Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  const errorText = await response.text();
Â  Â  Â  Â  Â  Â  console.error('âŒ Server error:', errorText);
Â  Â  Â  Â  Â  Â  throw new Error(`Server returned ${response.status}: ${errorText}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  console.log('âœ… Result:', result);

Â  Â  Â  Â  if (result.url) {
Â  Â  Â  Â  Â  Â  console.log('ğŸš€ Redirecting to Stripe...');
Â  Â  Â  Â  Â  Â  window.location.href = result.url;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  throw new Error(result.error || 'No checkout URL returned');
Â  Â  Â  Â  }

Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('âŒ Checkout error:', error);
Â  Â  Â  Â Â 
Â  Â  Â  Â  let errorMessage = 'âŒ Checkout Error\n\n';
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
Â  Â  Â  Â  Â  Â  errorMessage += 'Cannot connect to server.\n\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'Possible causes:\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'âœ— Netlify function not deployed\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'âœ— Function path incorrect\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'âœ— Internet connection issue\n\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'Check browser console (F12) for details.';
Â  Â  Â  Â  } else if (error.message.includes('404')) {
Â  Â  Â  Â  Â  Â  errorMessage += 'Payment function not found.\n\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'The Netlify function may not be deployed yet.\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'Make sure you:\n';
Â  Â  Â  Â  Â  Â  errorMessage += '1. Created netlify/functions/create-checkout.js\n';
Â  Â  Â  Â  Â  Â  errorMessage += '2. Pushed to GitHub\n';
Â  Â  Â  Â  Â  Â  errorMessage += '3. Netlify finished deploying\n\n';
Â  Â  Â  Â  Â  Â  errorMessage += 'Check Netlify deploy logs.';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  errorMessage += error.message;
Â  Â  Â  Â  Â  Â  errorMessage += '\n\nCheck console for more details.';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  alert(errorMessage);
Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  btn.textContent = 'Proceed to Checkout';
Â  Â  }
});

// Initial update
updateCart();
Â  Â  </script>
</body>
</html>
